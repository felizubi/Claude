class SocialOptimizer{constructor(){this.field_data={};this.set_field_data();this.scores={total:0};this.grades={a:80,b:60};var self=this;var image_check=setInterval(function(){if(false===self.are_preview_images_rendered()){return}clearInterval(image_check);self.update_scores();self.initialize_sidebar()},100);this.activate_listeners()}activate_listeners(){self=this;jQuery("#social_warfare").on("input","input, textarea",function(){self.update_scores()});jQuery("#social_warfare").on("change","input, textarea",function(){var image_check=setInterval(function(){if(false===self.are_preview_images_rendered()){return}clearInterval(image_check);self.update_scores()},50)});jQuery(document).on("click",".social_score_wrapper",function(){jQuery(".swp_sidebar_button").parent("button").click()})}are_preview_images_rendered(){var image_fields_keys=["swp_og_image","swp_pinterest_image","swp_twitter_card_image"];for(const field of image_fields_keys){var input=jQuery('input[name="'+field+'[]"]');if(input.val()!==""&&input.is(":visible")){var image=jQuery('input[name="'+field+'[]"]').siblings(".attachment-preview").find("img");if(image.height()==0){return false}}if(input.val()===""&&input.is(":visible")){var image=jQuery('input[name="'+field+'[]"]').siblings(".attachment-preview").find("img");if(image.height()>0){return false}}}return true}update_scores(){this.scores={};this.scores["total"]=0;this.set_field_data();for(const field of this.get_fields()){this.scores[field]=this.get_individual_score(field);this.scores["total"]=+this.scores["total"]+ +this.scores[field]["current_score"]}this.scores["total"]=Math.round(this.scores["total"]);this.update_total_score_badge();jQuery(document).trigger("scores_updated")}update_total_score_badge(){let color_class=this.get_alert_color(this.scores["total"]);jQuery(".social_score_wrapper .score_rating").removeClass(["red","amber","green"]).addClass(color_class).find(".score_rating_top").text(this.scores["total"])}get_individual_score(field){switch(this.field_data[field]["type"]){case"image":var scores=this.get_image_score(field);break;case"input":var scores=this.get_input_score(field);break}switch(field){case"swp_custom_tweet":var scores=this.get_custom_tweet_score();break;case"swp_og_title":var scores=this.get_og_title_score();break;case"swp_pinterest_description":var scores=this.get_pinterest_description_score();break}return scores}get_og_title_score(){var scores={percent:0,current_score:0,max_score:this.field_data["swp_custom_tweet"]["max_score"],messages:[]};let key="swp_og_title";var input_text=jQuery("#"+key).val();var input_length=input_text.length;var max_length=this.field_data[key]["max_length"];var ideal_length=this.field_data[key]["length"];if(0<input_length&&input_length<=ideal_length){var length_percent=1}else if(input_length===0){var length_percent=0}else{var length_percent=ideal_length/(ideal_length+(input_length-ideal_length)*3)}scores.messages.push({code:this.get_alert_color(length_percent*100),priority:1,label:"The recommended length of the Open Graph title is 55 characters or fewer. Yours is "+input_length+"."});var word_count=input_text.split(" ").length;if(input_length==0){var words_percent=0}else if(word_count<5){var words_percent=word_count/5}else{var words_percent=5/word_count}scores.messages.push({code:this.get_alert_color(words_percent*100),priority:1,label:"The most engaging number of words for a title is 5. Yours is "+word_count+". Short and concise works best."});if(0<input_length&&input_length<280){var max_length_percent=1}else if(input_length>280){var max_length_percent=0}else{var max_length_percent=0}scores.messages.push({code:this.get_alert_color(max_length_percent*100),priority:10,label:"The maximum absolute length for this field is 95 characters. Your title is "+input_length+" characters."});let factors=3;let max_length_score=this.calculate_subscores(max_length_percent,factors,scores.max_score);let length_score=this.calculate_subscores(length_percent,factors,scores.max_score);let words_score=this.calculate_subscores(words_percent,factors,scores.max_score);scores.current_score=Math.round(+length_score+ +max_length_score+ +words_score);scores.percent=Math.round(scores.current_score/scores.max_score*100);scores.messages=this.sort_messages(scores.messages);return scores}get_og_description_score(){var scores={percent:0,current_score:0,max_score:this.field_data["swp_custom_tweet"]["max_score"],messages:[]};let key="swp_og_description";var input_text=jQuery("#"+key).val();var input_length=input_text.length;var max_length=this.field_data[key]["max_length"];var ideal_length=this.field_data[key]["length"];if(0<input_length&&input_length<ideal_length){var length_percent=1}else if(0===input_length){var length_percent=0}else{var length_percent=ideal_length/(ideal_length+(input_length-ideal_length)*2)}scores.messages.push({code:this.get_alert_color(length_percent*100),priority:1,label:"The recommended length of the Open Graph description is "+ideal_length+" characters or fewer. Yours is "+input_length+"."});if(0<input_length&&input_length<max_length){var max_length_percent=1}else if(input_length>max_length){var max_length_percent=0}else{var max_length_percent=0}scores.messages.push({code:this.get_alert_color(max_length_percent*100),priority:10,label:"The maximum absolute length for this field is "+max_length+" characters. Your title is "+input_length+" characters."});let factors=2;let max_length_score=this.calculate_subscores(max_length_percent,factors,scores.max_score);let length_score=this.calculate_subscores(length_percent,factors,scores.max_score);scores.current_score=Math.round(+length_score+ +max_length_score);scores.percent=Math.round(scores.current_score/scores.max_score*100);scores.messages=this.sort_messages(scores.messages);return scores}get_custom_tweet_score(){var scores={percent:0,current_score:0,max_score:this.field_data["swp_custom_tweet"]["max_score"],messages:[]};let factors=3;var tweet_text=jQuery("#swp_custom_tweet").val();var input_length=tweet_text.length;var max_length=this.field_data["swp_custom_tweet"]["max_length"];var ideal_length=this.field_data["swp_custom_tweet"]["length"];if(70<input_length&&input_length<100){var length_percent=1}else if(0<input_length&&input_length<70){var length_percent=input_length/70}else if(input_length>70){var length_percent=100/input_length}else{var length_percent=0}scores.messages.push({code:this.get_alert_color(length_percent*100),priority:1,label:"The ideal length of a tweet is between 71 and 100 characters. Yours is "+input_length+"."});let hashtag_count=tweet_text.split("#").length-1;if(hashtag_count>2){var hashtag_percent=2/hashtag_count}else if(hashtag_count==0){var hashtag_percent=0}else{var hashtag_percent=hashtag_count/2}scores.messages.push({code:this.get_alert_color(hashtag_percent*100),priority:2,label:"For best performance, you should include 2 hashtags in your custom tweet. You have "+hashtag_count+"."});if(0<input_length&&input_length<280){var max_length_percent=1}else if(input_length>280){var max_length_percent=0}else{var max_length_percent=0}scores.messages.push({code:this.get_alert_color(max_length_percent*100),priority:10,label:"The maximum length for this field is 280 characters. Your custom tweet is "+input_length+" characters."});let max_length_score=this.calculate_subscores(max_length_percent,factors,scores.max_score);let length_score=this.calculate_subscores(length_percent,factors,scores.max_score);let hashtag_score=this.calculate_subscores(hashtag_percent,factors,scores.max_score);scores.current_score=Math.round(+length_score+ +hashtag_score+ +max_length_score);scores.percent=Math.round(scores.current_score/scores.max_score*100);scores.messages=this.sort_messages(scores.messages);return scores}get_pinterest_description_score(){var key="swp_pinterest_description";var scores={percent:0,current_score:0,max_score:this.field_data[key]["max_score"],messages:[]};var input_text=jQuery("#"+key).val();var input_length=input_text.length;var max_length=this.field_data[key]["max_length"];var ideal_length=this.field_data[key]["length"];var name=this.field_data[key]["name"];if(input_length<100){var length_percent=input_length/100}else if(input_length>200){var length_percent=200/input_length}else{var length_percent=1}scores.messages.push({code:this.get_alert_color(length_percent*100),priority:1,label:"The recommended length of the "+name+" is 100 - 200 characters. Yours is "+input_length+"."});let hashtag_count=input_text.split("#").length-1;if(hashtag_count<5){var hashtag_percent=hashtag_count/5}else if(hashtag_count>15){var hashtag_percent=15/hashtag_count}else{var hashtag_percent=1}scores.messages.push({code:this.get_alert_color(hashtag_percent*100),priority:2,label:"For maximum visibility, you should include 5 to 15 hashtags in your pinterest description. You have "+hashtag_count+"."});if(0<input_length&&input_length<max_length){var max_length_percent=1}else if(input_length>max_length){var max_length_percent=0}else{var max_length_percent=0}scores.messages.push({code:this.get_alert_color(max_length_percent*100),priority:10,label:"The absolute maximum length for this field is "+max_length+" characters. Yours is "+input_length+" characters."});let factors=3;let hashtag_score=this.calculate_subscores(hashtag_percent,factors,scores.max_score);let max_length_score=this.calculate_subscores(max_length_percent,factors,scores.max_score);let length_score=this.calculate_subscores(length_percent,factors,scores.max_score);scores.current_score=Math.round(+length_score+ +max_length_score+ +hashtag_score);scores.percent=Math.round(scores.current_score/scores.max_score*100);scores.messages=this.sort_messages(scores.messages);return scores}get_input_score(key){var scores={percent:0,current_score:0,max_score:this.field_data[key]["max_score"],messages:[]};var input_text=jQuery("#"+key).val();var input_length=input_text.length;var max_length=this.field_data[key]["max_length"];var ideal_length=this.field_data[key]["length"];var name=this.field_data[key]["name"];if(0<input_length&&input_length<ideal_length){var length_percent=input_length/ideal_length}else if(0===input_length){var length_percent=0}else{var length_percent=ideal_length/(ideal_length+(input_length-ideal_length)*2)}scores.messages.push({code:this.get_alert_color(length_percent*100),priority:1,label:"The recommended length of the "+name+" is "+ideal_length+" characters or fewer. Yours is "+input_length+"."});if(0<input_length&&input_length<max_length){var max_length_percent=1}else if(input_length>max_length){var max_length_percent=0}else{var max_length_percent=0}scores.messages.push({code:this.get_alert_color(max_length_percent*100),priority:10,label:"The maximum absolute length for this field is "+max_length+" characters. Yours is "+input_length+" characters."});let factors=2;let max_length_score=this.calculate_subscores(max_length_percent,factors,scores.max_score);let length_score=this.calculate_subscores(length_percent,factors,scores.max_score);scores.current_score=Math.round(+length_score+ +max_length_score);scores.percent=Math.round(scores.current_score/scores.max_score*100);scores.messages=this.sort_messages(scores.messages);return scores}get_image_score(field){var scores={percent:0,current_score:0,max_score:this.field_data[field]["max_score"],messages:[]};var image=jQuery('input[name="'+field+'[]"]').siblings(".attachment-preview").find("img");if(image.length===0){scores["messages"].push({code:"red",priority:1,label:"You have not provided an optimized image."})}else{var width=image[0].naturalWidth;var height=image[0].naturalHeight;var numerator=this.field_data[field]["numerator"];var denominator=this.field_data[field]["denominator"];var ar=width/height;var dar=numerator/denominator;if(ar>dar){var ratio_percent=dar/ar}else{var ratio_percent=ar/dar}scores["messages"].push({code:this.get_alert_color(ratio_percent*100),priority:1,label:"The ideal aspect ratio is "+numerator+":"+denominator+". Your image ratio is "+parseFloat((ar*denominator).toFixed(1))+":"+denominator+"."});var width_percent=.5,height_percent=.5;if(width<this.field_data[field]["width"]){var width_percent=width/this.field_data[field]["width"]*.5}if(height<this.field_data[field]["height"]){var height_percent=height/this.field_data[field]["height"]*.5}var size_percent=width_percent+height_percent;scores["messages"].push({code:this.get_alert_color(size_percent*100),priority:2,label:"The recommended size for this image is at least "+this.number_format(this.field_data[field]["width"])+"px by "+this.number_format(this.field_data[field]["height"])+"px. Your image is "+this.number_format(width)+"px by "+this.number_format(height)+"px."});var min_size=1;if(width<200||height<200){var min_size=0}scores["messages"].push({code:this.get_alert_color(min_size*100),priority:10,label:"The absolute minimum size for this image is "+this.number_format(this.field_data[field]["min_width"])+"px by "+this.number_format(this.field_data[field]["min_height"])+"px. Your image is "+this.number_format(width)+"px by "+this.number_format(height)+"px."})}let factors=2;let ratio_score=this.calculate_subscores(ratio_percent,factors,scores.max_score);let size_score=this.calculate_subscores(size_percent,factors,scores.max_score);if(1===min_size){scores.current_score=Math.round(+ratio_score+ +size_score);scores.percent=Math.round(scores.current_score/scores.max_score*100)}else{scores.current_score=scores.percent=0}scores.messages=this.sort_messages(scores.messages);return scores}calculate_subscores(percent,factors,max_score){return percent*max_score/factors}sort_messages(messages){messages.sort(function(a,b){switch(a.code){case"red":var first=1;break;case"amber":var first=2;break;case"green":var first=3;break}switch(b.code){case"red":var second=1;break;case"amber":var second=2;break;case"green":var second=3;break}if(first>second){return 1}else if(second>first){return-1}return a.priority<b.priority});return messages}set_field_data(){var field_data={swp_og_image:{name:"Open Graph Image",type:"image",width:1200,height:628,min_width:200,min_height:200,numerator:"1.9",denominator:"1",max_score:this.get_max_scores("swp_og_image")},swp_og_title:{name:"Open Graph Title",type:"input",length:55,max_length:95,max_score:this.get_max_scores("swp_og_title")},swp_og_description:{name:"Open Graph Description",type:"input",length:60,max_length:200,max_score:this.get_max_scores("swp_og_description")},swp_twitter_card_title:{name:"Twitter Card Title",type:"input",length:55,max_length:95,max_score:this.get_max_scores("swp_twitter_card_title")},swp_twitter_card_description:{name:"Twitter Card Description",type:"input",length:55,max_length:150,max_score:this.get_max_scores("swp_twitter_card_description")},swp_twitter_card_image:{name:"Twitter Card Image",type:"image",width:1200,height:628,min_width:200,min_height:200,numerator:"1.9",denominator:"1",max_score:this.get_max_scores("swp_twitter_card_image")},swp_custom_tweet:{name:"Custom Tweet",type:"input",length:100,max_length:240,max_score:this.get_max_scores("swp_custom_tweet")},swp_pinterest_image:{name:"Pinterest Image",type:"image",width:735,height:1102,min_width:238,min_height:356,numerator:"2",denominator:"3",max_score:this.get_max_scores("swp_pinterest_image")},swp_pinterest_description:{name:"Pinterest Description",type:"input",length:500,max_length:500,max_score:this.get_max_scores("swp_pinterest_description")}};const fields=this.get_fields();for(const field of fields){this.field_data[field]=field_data[field]}}get_max_scores(field=0){if(jQuery("#swp_twitter_use_open_graph").is(":checked")){var max_grades={swp_og_image:20,swp_og_title:15,swp_og_description:15,swp_custom_tweet:15,swp_pinterest_image:20,swp_pinterest_description:15}}else{var max_grades={swp_og_image:15,swp_og_title:10,swp_og_description:10,swp_custom_tweet:10,swp_twitter_card_image:10,swp_twitter_card_title:10,swp_twitter_card_description:10,swp_pinterest_image:15,swp_pinterest_description:10}}if(0!==field){return max_grades[field]}return max_grades}get_fields(){return Object.keys(this.get_max_scores())}initialize_sidebar(){var self=this;if("undefined"===typeof wp.plugins){return}this.plugin=wp.plugins.registerPlugin("social-warfare-pro-sidebar",{render:function(){return React.createElement(wp.editPost.PluginSidebar,{name:"social-warfare-pro-sidebar",className:"social-warfare-sidebar",icon:self.rax_generate_icon(),title:"Optimize for Social"},[self.rax_generate_total_score_section(),wp.element.createElement(SWPSidebar)])}})}rax_generate_sidebar_sections(){let fields=["swp_og_image"];let elements=[];for(const field_key of Object.keys(this.scores)){if(field_key==="total")continue;let element=wp.element.createElement(SWPSidebarSection,{field_key:field_key,messages:this.scores[field_key].messages});elements.push(element)}return elements}rax_generate_total_score_section(){return wp.element.createElement("div",{className:"sidebar_score_wrapper"},[wp.element.createElement("div",{className:"score_title"},"Optimize for Social"),wp.element.createElement(SWPScoreBadge,{section:"total",score:this.scores.total,max_score:100}),wp.element.createElement("div",{className:"swp_clearfix"}),wp.element.createElement("p",{className:"pro-tip"},"Follow the tips below to maximize your reach on social media.")])}rax_generate_icon(){return wp.element.createElement("svg",{height:24,width:24,viewBox:"0 -2 24 24",className:"swp_sidebar_button"},wp.element.createElement("path",{d:"M12 1.5q-3.75 0-6.375 2.625t-2.625 6.375 2.625 6.375 6.375 2.625 6.375-2.625 2.625-6.375-2.625-6.375-6.375-2.625zM11.906 17.391q-2.578 0-3.68-1.266t-1.195-2.766q0-0.469 0.563-0.609l2.063-0.469q0.609-0.094 0.609 0.563 0.141 1.406 1.641 1.406 0.703 0 1.148-0.328t0.352-0.703q-0.141-0.516-1.102-0.961t-2.063-0.82-1.992-1.359-0.891-2.438q0-0.375 0.141-0.891t0.516-1.266 1.383-1.242 2.508-0.492q2.625 0 3.727 1.242t1.148 2.648q0 0.469-0.516 0.609l-2.156 0.469q-0.609 0.094-0.609-0.469-0.234-1.266-1.641-1.266-0.563 0-0.891 0.258t-0.234 0.633q0.094 0.469 1.102 0.938t2.133 0.867 2.063 1.43 0.938 2.531q0 0.141-0.070 0.516t-0.398 0.961-0.867 1.078-1.5 0.844-2.227 0.352z"}))}get_alert_color(percent){switch(true){case percent<this.grades.b:var color_class="red";break;case percent<this.grades.a:var color_class="amber";break;default:var color_class="green";break}return color_class}number_format(num){return num.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}}class SWPSidebar extends React.Component{constructor(props){super(props);this.update_sidebar=this.update_sidebar.bind(this);let toggle=document.getElementById("swp_twitter_use_open_graph");if(null!==toggle){toggle.onchange=this.update_sidebar}}update_sidebar(){socialWarfare.SocialOptimizer.update_scores();this.forceUpdate()}render(){let sections=[];for(const field_key of Object.keys(self.scores)){if(field_key==="total")continue;let section=wp.element.createElement(SWPSidebarSection,{field_key:field_key,messages:self.scores[field_key].messages});sections.push(section)}return sections}}class SWPSidebarSection extends React.Component{constructor(props){super(props);this.props.visible="hidden";this.setState({visible:"hidden",scores:socialWarfare.SocialOptimizer.scores[this.props.field_key]});this.focus_toggle=this.focus_toggle.bind(this);this.focus=this.focus.bind(this);jQuery(document).on("focus","#social_warfare textarea, #social_warfare input",this.focus);jQuery(document).on("change","#social_warfare textarea, #social_warfare input",this.focus)}focus(event){this.props.visible="hidden";this.props.messages=socialWarfare.SocialOptimizer.scores[this.props.field_key].messages;if(jQuery(event.target).is("#"+this.props.field_key)||jQuery(event.target).is('[name="'+this.props.field_key+'"]')){this.props.visible="visible"}this.setState({visible:this.props.visible,messages:this.props.messages})}focus_toggle(){if("visible"===this.props.visible){this.props.visible="hidden"}else{this.props.visible="visible"}this.props.messages=socialWarfare.SocialOptimizer.scores[this.props.field_key].messages;this.setState({visible:this.props.visible,messages:socialWarfare.SocialOptimizer.scores[this.props.field_key].messages})}render(){if("undefined"===typeof this.props.visible){this.props.visible="hidden"}let element=wp.element.createElement("div",{className:"sidebar_section_wrapper "+this.props.field_key},[wp.element.createElement("div",{className:"section-title-wrapper",onClick:this.focus_toggle},[wp.element.createElement("div",{className:"score_title "+this.props.field_key},socialWarfare.SocialOptimizer.field_data[this.props.field_key].name),wp.element.createElement(SWPScoreBadge,{section:this.props.field_key,score:socialWarfare.SocialOptimizer.scores[this.props.field_key].current_score,max_score:socialWarfare.SocialOptimizer.scores[this.props.field_key].max_score})]),wp.element.createElement("div",{className:"section_messages_wrapper "+this.props.visible},wp.element.createElement(SWPScoreMessages,{section:this.props.field_key,messages:this.props.messages}))]);return element}}class SWPScoreBadge extends React.Component{constructor(props){super(props);this.update=this.update.bind(this);this.setState({score:this.props.score});jQuery(document).on("scores_updated",this.update)}update(){if("undefined"===typeof socialWarfare.SocialOptimizer.scores[this.props.section]){return}if(this.props.section=="total"){this.props.score=socialWarfare.SocialOptimizer.scores.total}else{this.props.score=socialWarfare.SocialOptimizer.scores[this.props.section].current_score}this.setState({score:this.props.score})}render(){return wp.element.createElement("div",{className:"score_rating "+self.get_alert_color(this.props.score/this.props.max_score*100)},[wp.element.createElement("div",{className:"score_rating_top"},this.props.score),wp.element.createElement("div",{className:"score_rating_bottom"},this.props.max_score)])}}class SWPScoreMessages extends React.Component{constructor(props){super(props);this.update=this.update.bind(this);this.setState({messages:this.props.messages});jQuery(document).on("scores_updated",this.update)}update(){if("undefined"===typeof socialWarfare.SocialOptimizer.scores[this.props.section]){return}this.props.messages=socialWarfare.SocialOptimizer.scores[this.props.section].messages;this.setState({score:socialWarfare.SocialOptimizer.scores.messages})}render(){if("undefined"==typeof this.props.messages){return null}let elements=[];this.props.messages.forEach(function(message){let element=wp.element.createElement("p",{className:"individual-tip "+message.code},message.label);elements.push(element)});return elements}}jQuery(document).ready(function(){window.socialWarfare=window.socialWarfare||{};socialWarfare.SocialOptimizer=new SocialOptimizer});
//# sourceMappingURL=SocialOptimizer.min.js.map